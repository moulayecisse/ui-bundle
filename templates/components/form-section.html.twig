{% props
  title = '',
  subtitle = null,
  icon = null,
  iconColor = 'primary',
  bordered = true,
  collapsible = false,
  collapsed = false,
  class = '',
%}

{% set iconColorClasses = {
  'primary': { 'bg': 'bg-primary-100 dark:bg-primary-900/30', 'text': 'text-primary-600 dark:text-primary-400' },
  'gray': { 'bg': 'bg-gray-100 dark:bg-slate-700', 'text': 'text-gray-600 dark:text-gray-400' },
  'success': { 'bg': 'bg-emerald-100 dark:bg-emerald-900/30', 'text': 'text-emerald-600 dark:text-emerald-400' },
  'warning': { 'bg': 'bg-amber-100 dark:bg-amber-900/30', 'text': 'text-amber-600 dark:text-amber-400' },
  'danger': { 'bg': 'bg-red-100 dark:bg-red-900/30', 'text': 'text-red-600 dark:text-red-400' },
} %}

{% set currentIconColor = iconColorClasses[iconColor] ?? iconColorClasses['primary'] %}

{% set header_actions_block %}{% block header_actions '' %}{% endset %}
{% set footer_block %}{% block footer '' %}{% endset %}

<div
  {{ attributes }}
  {% if collapsible %}
    data-controller="cisse--ui-bundle--form-section"
    data-cisse--ui-bundle--form-section-collapsed-value="{{ collapsed ? 'true' : 'false' }}"
  {% endif %}
  class="{{ ('bg-white dark:bg-slate-800 rounded-2xl overflow-hidden ' ~ (bordered ? 'border border-gray-100 dark:border-slate-700 shadow-sm' : '') ~ ' ' ~ class)|tailwind_merge }}"
>
  {# Header #}
  <div
    class="p-5 border-b border-gray-100 dark:border-slate-700 bg-gradient-to-r from-gray-50 to-white dark:from-slate-800 dark:to-slate-800 {{ collapsible ? 'cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors' : '' }}"
    {% if collapsible %}data-action="click->cisse--ui-bundle--form-section#toggle"{% endif %}
  >
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        {# Icon #}
        {% if icon %}
          <div class="size-10 rounded-xl flex items-center justify-center {{ currentIconColor.bg }}">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5 {{ currentIconColor.text }}" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              {{ icon|raw }}
            </svg>
          </div>
        {% endif %}

        {# Title & Subtitle #}
        <div>
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
            {{ title }}
          </h2>
          {% if subtitle %}
            <p class="text-sm text-gray-500 dark:text-gray-400">
              {{ subtitle }}
            </p>
          {% endif %}
        </div>
      </div>

      {# Collapse toggle #}
      {% if collapsible %}
        <button
          type="button"
          data-cisse--ui-bundle--form-section-target="toggle"
          data-action="click->cisse--ui-bundle--form-section#toggle:stop"
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors"
        >
          <svg xmlns="http://www.w3.org/2000/svg" data-cisse--ui-bundle--form-section-target="chevron" class="w-5 h-5 text-gray-400 transition-transform duration-200 {{ collapsed ? '-rotate-90' : '' }}" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
          </svg>
        </button>
      {% endif %}

      {# Header actions #}
      {{ header_actions_block|raw }}
    </div>
  </div>

  {# Content #}
  <div
    {% if collapsible %}data-cisse--ui-bundle--form-section-target="content"{% endif %}
    class="p-5 sm:p-6 {{ collapsed ? 'hidden' : '' }}"
  >
    {% block content '' %}
  </div>

  {# Footer #}
  {% if footer_block|trim %}
    <div
      {% if collapsible %}data-cisse--ui-bundle--form-section-target="footer"{% endif %}
      class="px-5 py-4 bg-gray-50 dark:bg-slate-800/50 border-t border-gray-100 dark:border-slate-700 {{ collapsed ? 'hidden' : '' }}"
    >
      {{ footer_block|raw }}
    </div>
  {% endif %}
</div>
