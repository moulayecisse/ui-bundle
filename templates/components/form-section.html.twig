{% props
  title = '',
  subtitle = null,
  icon = null,
  iconColor = 'primary',
  bordered = true,
  collapsible = false,
  collapsed = false,
  class = '',
%}

{# Nested attributes for fine-grained customization #}
{% set headerAttrs = attributes.nested('header') %}
{% set iconAttrs = attributes.nested('icon') %}
{% set titleAttrs = attributes.nested('title') %}
{% set subtitleAttrs = attributes.nested('subtitle') %}
{% set toggleAttrs = attributes.nested('toggle') %}
{% set contentAttrs = attributes.nested('content') %}
{% set footerAttrs = attributes.nested('footer') %}

{% set header_actions_block %}{% block header_actions '' %}{% endset %}
{% set footer_block %}{% block footer '' %}{% endset %}

<div
  {{ attributes }}
  {% if collapsible %}
    data-controller="cisse--ui-bundle--form-section"
    data-cisse--ui-bundle--form-section-collapsed-value="{{ collapsed ? 'true' : 'false' }}"
  {% endif %}
  class="{{ ('bg-white dark:bg-slate-800 rounded-2xl overflow-hidden ' ~ (bordered ? 'border border-gray-100 dark:border-slate-700 shadow-sm' : '') ~ ' ' ~ class)|tailwind_merge }}"
>
  {# Header #}
  <div
    class="{{ ('p-5 border-b border-gray-100 dark:border-slate-700 bg-gradient-to-r from-gray-50 to-white dark:from-slate-800 dark:to-slate-800 ' ~ (collapsible ? 'cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors' : '') ~ ' ' ~ headerAttrs.render('class'))|tailwind_merge }}"
    {{ headerAttrs.without('class') }}
    {% if collapsible %}data-action="click->cisse--ui-bundle--form-section#toggle"{% endif %}
  >
    <div class="flex items-center justify-between">
      <twig:ui:form-section:header
        variant="card"
        :icon="icon"
        :iconColor="iconColor"
        :subtitle="subtitle"
        class="col-span-auto"
        icon:class="{{ iconAttrs.render('class') }}"
        title:class="{{ titleAttrs.render('class') }}"
        subtitle:class="{{ subtitleAttrs.render('class') }}"
      >
        {{ title }}
      </twig:ui:form-section:header>

      <div class="flex items-center gap-2">
        {% if collapsible %}
          <button
            type="button"
            data-cisse--ui-bundle--form-section-target="toggle"
            data-action="click->cisse--ui-bundle--form-section#toggle:stop"
            class="{{ ('p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors ' ~ toggleAttrs.render('class'))|tailwind_merge }}"
            {{ toggleAttrs.without('class') }}
          >
            <twig:ux:icon name="heroicons:chevron-down" data-cisse--ui-bundle--form-section-target="chevron" class="size-5 text-gray-400 transition-transform duration-200 {{ collapsed ? '-rotate-90' : '' }}" />
          </button>
        {% endif %}
        {{ header_actions_block|raw }}
      </div>
    </div>
  </div>

  {# Content #}
  <div
    {% if collapsible %}data-cisse--ui-bundle--form-section-target="content"{% endif %}
    class="{{ ('p-5 sm:p-6 ' ~ (collapsed ? 'hidden' : '') ~ ' ' ~ contentAttrs.render('class'))|tailwind_merge }}"
    {{ contentAttrs.without('class') }}
  >
    {% block content '' %}
  </div>

  {# Footer #}
  {% if footer_block|trim %}
    <div
      {% if collapsible %}data-cisse--ui-bundle--form-section-target="footer"{% endif %}
      class="{{ ('px-5 py-4 bg-gray-50 dark:bg-slate-800/50 border-t border-gray-100 dark:border-slate-700 ' ~ (collapsed ? 'hidden' : '') ~ ' ' ~ footerAttrs.render('class'))|tailwind_merge }}"
      {{ footerAttrs.without('class') }}
    >
      {{ footer_block|raw }}
    </div>
  {% endif %}
</div>
