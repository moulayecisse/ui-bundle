{# templates/components/Ui/icon-picker.html.twig #}
{# Icon picker component with Iconify API search #}
{% props
    class = '',
    value = '',
    name = 'icon',
    id = null,
    label = null,
    placeholder = 'Search for an icon...',
    help = null,
    error = null,
    required = false,
    disabled = false,
    collections = 'mdi,heroicons,lucide',
    limit = 48
%}

{# Nested attributes for fine-grained customization #}
{% set labelAttrs = attributes.nested('label') %}
{% set triggerAttrs = attributes.nested('trigger') %}
{% set displayAttrs = attributes.nested('display') %}
{% set modalAttrs = attributes.nested('modal') %}
{% set searchAttrs = attributes.nested('search') %}
{% set gridAttrs = attributes.nested('grid') %}
{% set iconAttrs = attributes.nested('icon') %}

{% set popularIcons = [
    'mdi:heart', 'mdi:star', 'mdi:home', 'mdi:account', 'mdi:email', 'mdi:phone',
    'mdi:calendar', 'mdi:clock', 'mdi:check', 'mdi:close', 'mdi:plus', 'mdi:minus',
    'mdi:stethoscope', 'mdi:hospital', 'mdi:medical-bag', 'mdi:pill', 'mdi:heart-pulse',
    'mdi:tooth', 'mdi:eye', 'mdi:brain', 'mdi:lungs', 'mdi:bone',
    'heroicons:heart', 'heroicons:star', 'heroicons:home', 'heroicons:user',
    'heroicons:envelope', 'heroicons:phone', 'heroicons:calendar', 'heroicons:clock',
    'heroicons:check', 'heroicons:x-mark', 'heroicons:plus', 'heroicons:minus',
    'lucide:heart', 'lucide:star', 'lucide:home', 'lucide:user',
    'lucide:mail', 'lucide:phone', 'lucide:calendar', 'lucide:clock',
    'lucide:check', 'lucide:x', 'lucide:plus', 'lucide:minus'
] %}

{% set _id = id ?? name %}
{% set hasError = error is not empty %}

{% set class = ('relative ' ~ class)|tailwind_merge %}

<div
    {{ attributes }}
    data-controller="cisse--ui-bundle--icon-picker"
    data-cisse--ui-bundle--icon-picker-collections-value="{{ collections }}"
    data-cisse--ui-bundle--icon-picker-limit-value="{{ limit }}"
    data-cisse--ui-bundle--icon-picker-popular-icons-value="{{ popularIcons|json_encode }}"
    class="{{ class }}"
>
    {# Hidden input for form submission #}
    <input type="hidden" name="{{ name }}" data-cisse--ui-bundle--icon-picker-target="input" value="{{ value }}" />

    {# Label #}
    {% if label %}
        <twig:ui:label for="{{ _id }}" :error="error" class="{{ labelAttrs.render('class') }}" {{ ...labelAttrs.without('class') }}>
            {{ label }}
            {% if required %}<span class="text-red-500 ml-0.5">*</span>{% endif %}
        </twig:ui:label>
    {% endif %}

    {# Trigger button #}
    <button
        id="{{ _id }}"
        type="button"
        data-action="click->cisse--ui-bundle--icon-picker#open"
        {% if disabled %}disabled{% endif %}
        class="{{ ('mt-1 flex w-full items-center gap-3 rounded-lg border bg-white px-3 py-2 text-left text-sm shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-900 ' ~ (hasError ? 'border-red-500 focus:border-red-500 focus:ring-red-500' : 'border-gray-300 focus:border-primary dark:border-gray-700') ~ ' ' ~ (disabled ? 'cursor-not-allowed bg-gray-50 dark:bg-gray-800' : 'cursor-pointer hover:border-gray-400 dark:hover:border-gray-600') ~ ' ' ~ triggerAttrs.render('class'))|tailwind_merge }}"
        {{ triggerAttrs.without('class') }}
    >
        {# Selected icon display #}
        <div data-cisse--ui-bundle--icon-picker-target="display" class="{{ ('flex items-center gap-2 flex-1 ' ~ (value ? '' : 'hidden') ~ ' ' ~ displayAttrs.render('class'))|tailwind_merge }}" {{ displayAttrs.without('class') }}>
            <div class="flex size-8 items-center justify-center rounded bg-gray-100 dark:bg-gray-800">
                <twig:ux:icon
                    data-cisse--ui-bundle--icon-picker-target="selectedIcon"
                    name="{{ value ?: 'heroicons:photo-20-solid' }}"
                    class="size-5 text-gray-700 dark:text-gray-300"
                />
            </div>
            <span data-cisse--ui-bundle--icon-picker-target="selectedName" class="text-gray-700 dark:text-gray-300 font-mono text-xs truncate">
                {{ value }}
            </span>
        </div>

        {# Placeholder #}
        <span data-cisse--ui-bundle--icon-picker-target="placeholder" class="flex-1 text-gray-400 dark:text-gray-500 {{ value ? 'hidden' : '' }}">
            {{ placeholder }}
        </span>

        {# Clear button #}
        {% if not disabled %}
            <button
                type="button"
                data-action="click->cisse--ui-bundle--icon-picker#clear"
                data-cisse--ui-bundle--icon-picker-target="clearButton"
                class="p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 {{ value ? '' : 'hidden' }}"
            >
                <twig:ux:icon name="heroicons:x-mark-20-solid" class="size-4" />
            </button>
        {% endif %}

        <twig:ux:icon name="heroicons:chevron-down-20-solid" class="size-4 text-gray-400" />
    </button>

    {# Help/Error text #}
    {% if help and not hasError %}
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">{{ help }}</p>
    {% endif %}
    {% if hasError %}
        <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ error }}</p>
    {% endif %}

    {# Modal backdrop #}
    <div
        data-cisse--ui-bundle--icon-picker-target="backdrop"
        data-action="click->cisse--ui-bundle--icon-picker#close"
        class="fixed inset-0 z-50 bg-black/20 hidden"
    ></div>

    {# Picker modal #}
    <div
        data-cisse--ui-bundle--icon-picker-target="modal"
        class="{{ ('fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md rounded-lg border border-gray-200 bg-white p-4 shadow-xl dark:border-gray-700 dark:bg-gray-900 hidden ' ~ modalAttrs.render('class'))|tailwind_merge }}"
        {{ modalAttrs.without('class') }}
    >
        {# Search input #}
        <div class="relative mb-4">
            <twig:ux:icon name="heroicons:magnifying-glass-20-solid" class="absolute left-3 top-1/2 size-4 -translate-y-1/2 text-gray-400" />
            <input
                type="text"
                data-cisse--ui-bundle--icon-picker-target="search"
                data-action="input->cisse--ui-bundle--icon-picker#search"
                placeholder="{{ placeholder }}"
                class="{{ ('w-full rounded-lg border border-gray-300 bg-white py-2 pl-10 pr-4 text-sm text-gray-800 placeholder-gray-400 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200 dark:placeholder-gray-500 ' ~ searchAttrs.render('class'))|tailwind_merge }}"
                {{ searchAttrs.without('class') }}
            />
            <div data-cisse--ui-bundle--icon-picker-target="loader" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
                <twig:ux:icon name="heroicons:arrow-path-20-solid" class="size-4 animate-spin text-gray-400" />
            </div>
        </div>

        {# Icons grid #}
        <div class="max-h-64 ui-scrollbar overflow-y-auto">
            {# No results message #}
            <div data-cisse--ui-bundle--icon-picker-target="noResults" class="py-8 text-center text-sm text-gray-500 hidden">
                No icons found
            </div>

            {# Icons container #}
            <div data-cisse--ui-bundle--icon-picker-target="grid" class="{{ ('grid grid-cols-8 gap-1 ' ~ gridAttrs.render('class'))|tailwind_merge }}" {{ gridAttrs.without('class') }}>
                {% for icon in popularIcons %}
                    <button
                        type="button"
                        data-action="click->cisse--ui-bundle--icon-picker#select"
                        data-icon="{{ icon }}"
                        class="{{ ('icon-button flex size-9 items-center justify-center rounded transition-colors hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 ' ~ iconAttrs.render('class'))|tailwind_merge }}"
                        {{ iconAttrs.without('class') }}
                        title="{{ icon }}"
                    >
                        <twig:ux:icon name="{{ icon }}" class="size-5" />
                    </button>
                {% endfor %}
            </div>
        </div>

        {# Footer #}
        <div class="mt-4 flex items-center justify-between border-t border-gray-200 pt-4 dark:border-gray-700">
            <p data-cisse--ui-bundle--icon-picker-target="count" class="text-xs text-gray-500">
                Popular icons
            </p>
            <button
                type="button"
                data-action="click->cisse--ui-bundle--icon-picker#close"
                class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"
            >
                Close
            </button>
        </div>
    </div>
</div>
