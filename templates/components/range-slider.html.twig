{# templates/components/Ui/range-slider.html.twig #}
{# Dual-value range slider component #}
{% props
    class = '',
    min = 0,
    max = 100,
    step = 1,
    minValue = 25,
    maxValue = 75,
    disabled = false,
    showLabels = true,
    showMinMax = true,
    minName = 'range_min',
    maxName = 'range_max',
    formatLabel = null,
    size = 'md',
    color = 'primary',
%}

{# Nested attributes for fine-grained customization #}
{% set labelsAttrs = attributes.nested('labels') %}
{% set trackAttrs = attributes.nested('track') %}
{% set rangeAttrs = attributes.nested('range') %}
{% set handleAttrs = attributes.nested('handle') %}
{% set minMaxAttrs = attributes.nested('minMax') %}

{% set sizeConfig = {
    'sm': { track: 'h-1', handle: 'size-4', label: 'text-xs', minMax: 'text-xs' },
    'md': { track: 'h-2', handle: 'size-5', label: 'text-sm', minMax: 'text-xs' },
    'lg': { track: 'h-3', handle: 'size-6', label: 'text-base', minMax: 'text-sm' },
} %}

{% set colorConfig = {
    'primary': { range: 'bg-primary-500', handle: 'border-primary-500' },
    'secondary': { range: 'bg-secondary-500', handle: 'border-secondary-500' },
    'success': { range: 'bg-green-500', handle: 'border-green-500' },
    'warning': { range: 'bg-yellow-500', handle: 'border-yellow-500' },
    'danger': { range: 'bg-red-500', handle: 'border-red-500' },
} %}

{% set currentSize = sizeConfig[size] ?? sizeConfig['md'] %}
{% set currentColor = colorConfig[color] ?? colorConfig['primary'] %}

{% set class = ('space-y-2 ' ~ class)|tailwind_merge %}

<div
    {{ attributes }}
    data-controller="cisse--ui-bundle--range-slider"
    data-cisse--ui-bundle--range-slider-min-value="{{ min }}"
    data-cisse--ui-bundle--range-slider-max-value="{{ max }}"
    data-cisse--ui-bundle--range-slider-step-value="{{ step }}"
    data-cisse--ui-bundle--range-slider-disabled-value="{{ disabled ? 'true' : 'false' }}"
    class="{{ class }}"
>
    {# Hidden inputs for form submission #}
    <input type="hidden" name="{{ minName }}" data-cisse--ui-bundle--range-slider-target="minInput" value="{{ minValue }}" />
    <input type="hidden" name="{{ maxName }}" data-cisse--ui-bundle--range-slider-target="maxInput" value="{{ maxValue }}" />

    {# Labels row #}
    {% if showLabels %}
        <div class="{{ ('flex justify-between font-medium text-gray-700 dark:text-gray-300 ' ~ currentSize.label ~ ' ' ~ labelsAttrs.render('class'))|tailwind_merge }}" {{ labelsAttrs.without('class') }}>
            <span data-cisse--ui-bundle--range-slider-target="minLabel">{{ minValue }}</span>
            <span data-cisse--ui-bundle--range-slider-target="maxLabel">{{ maxValue }}</span>
        </div>
    {% endif %}

    {# Slider track #}
    <div
        data-cisse--ui-bundle--range-slider-target="track"
        data-action="click->cisse--ui-bundle--range-slider#handleTrackClick"
        class="{{ ('relative rounded-full cursor-pointer ' ~ currentSize.track ~ ' ' ~ (disabled ? 'bg-gray-200 dark:bg-gray-700 cursor-not-allowed' : 'bg-gray-200 dark:bg-gray-700') ~ ' ' ~ trackAttrs.render('class'))|tailwind_merge }}"
        {{ trackAttrs.without('class') }}
    >
        {# Active range #}
        <div
            data-cisse--ui-bundle--range-slider-target="range"
            class="{{ ('absolute h-full rounded-full ' ~ (disabled ? 'bg-gray-400' : currentColor.range) ~ ' ' ~ rangeAttrs.render('class'))|tailwind_merge }}"
            {{ rangeAttrs.without('class') }}
        ></div>

        {# Min handle #}
        <div
            data-cisse--ui-bundle--range-slider-target="minHandle"
            data-action="mousedown->cisse--ui-bundle--range-slider#handleMinMouseDown touchstart->cisse--ui-bundle--range-slider#handleMinTouchStart"
            class="{{ ('absolute top-1/2 -translate-y-1/2 -translate-x-1/2 rounded-full border-2 shadow transition-shadow ' ~ currentSize.handle ~ ' ' ~ (disabled ? 'bg-gray-300 border-gray-400 cursor-not-allowed' : 'bg-white ' ~ currentColor.handle ~ ' cursor-grab hover:shadow-md active:cursor-grabbing') ~ ' ' ~ handleAttrs.render('class'))|tailwind_merge }}"
            {{ handleAttrs.without('class') }}
        ></div>

        {# Max handle #}
        <div
            data-cisse--ui-bundle--range-slider-target="maxHandle"
            data-action="mousedown->cisse--ui-bundle--range-slider#handleMaxMouseDown touchstart->cisse--ui-bundle--range-slider#handleMaxTouchStart"
            class="{{ ('absolute top-1/2 -translate-y-1/2 -translate-x-1/2 rounded-full border-2 shadow transition-shadow ' ~ currentSize.handle ~ ' ' ~ (disabled ? 'bg-gray-300 border-gray-400 cursor-not-allowed' : 'bg-white ' ~ currentColor.handle ~ ' cursor-grab hover:shadow-md active:cursor-grabbing') ~ ' ' ~ handleAttrs.render('class'))|tailwind_merge }}"
            {{ handleAttrs.without('class') }}
        ></div>
    </div>

    {# Min/Max labels #}
    {% if showMinMax %}
        <div class="{{ ('flex justify-between text-gray-500 dark:text-gray-400 ' ~ currentSize.minMax ~ ' ' ~ minMaxAttrs.render('class'))|tailwind_merge }}" {{ minMaxAttrs.without('class') }}>
            <span>{{ min }}</span>
            <span>{{ max }}</span>
        </div>
    {% endif %}
</div>
