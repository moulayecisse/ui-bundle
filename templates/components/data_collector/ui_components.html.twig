{% extends '@WebProfiler/Profiler/layout.html.twig' %}

{% block toolbar %}
    {% set icon %}
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7" rx="1"/>
            <rect x="14" y="3" width="7" height="7" rx="1"/>
            <rect x="3" y="14" width="7" height="7" rx="1"/>
            <rect x="14" y="14" width="7" height="7" rx="1"/>
        </svg>
        <span class="sf-toolbar-value">{{ collector.totalCount }}</span>
    {% endset %}

    {% set text %}
        <div class="sf-toolbar-info-piece">
            <b>UI Components</b>
            <span class="sf-toolbar-status">{{ collector.totalCount }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Unique</b>
            <span>{{ collector.uniqueCount }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Render time</b>
            <span>{{ '%0.2f'|format(collector.totalDuration * 1000) }} ms</span>
        </div>
    {% endset %}

    {{ include('@WebProfiler/Profiler/toolbar_item.html.twig', { 'link': profiler_url }) }}
{% endblock %}

{% block menu %}
    <span class="label{% if collector.totalCount == 0 %} disabled{% endif %}">
        <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="7" height="7" rx="1"/>
                <rect x="14" y="3" width="7" height="7" rx="1"/>
                <rect x="3" y="14" width="7" height="7" rx="1"/>
                <rect x="14" y="14" width="7" height="7" rx="1"/>
            </svg>
        </span>
        <strong>UI Components</strong>
        <span class="count">
            <span>{{ collector.totalCount }}</span>
        </span>
    </span>
{% endblock %}

{% block panel %}
    <h2>UI Components</h2>

    {% if collector.totalCount == 0 %}
        <div class="empty">
            <p>No UI components were rendered on this page.</p>
        </div>
    {% else %}
        <div class="metrics">
            <div class="metric-group">
                <div class="metric">
                    <span class="value">{{ collector.totalCount }}</span>
                    <span class="label">Total Renders</span>
                </div>
                <div class="metric">
                    <span class="value">{{ collector.uniqueCount }}</span>
                    <span class="label">Unique Components</span>
                </div>
                <div class="metric">
                    <span class="value">{{ '%0.2f'|format(collector.totalDuration * 1000) }} ms</span>
                    <span class="label">Total Render Time</span>
                </div>
            </div>
        </div>

        <h3>Component Usage</h3>
        <table>
            <thead>
                <tr>
                    <th>Component</th>
                    <th class="text-right">Render Count</th>
                </tr>
            </thead>
            <tbody>
                {% for name, count in collector.components %}
                    <tr>
                        <td><code>&lt;twig:Ui:{{ name|replace({':': ':'}) }}&gt;</code></td>
                        <td class="text-right">{{ count }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if collector.hierarchy|length > 0 %}
            <h3>Component Hierarchy</h3>
            <div class="sf-tree">
                {{ _self.render_hierarchy(collector.hierarchy) }}
            </div>
        {% endif %}
    {% endif %}
{% endblock %}

{% macro render_hierarchy(items) %}
    <ul>
        {% for item in items %}
            <li>
                <div class="sf-tree-item">
                    <code>&lt;twig:Ui:{{ item.name }}&gt;</code>
                    <span class="text-muted">({{ '%0.3f'|format(item.duration * 1000) }} ms)</span>
                </div>
                {% if item.children|length > 0 %}
                    {{ _self.render_hierarchy(item.children) }}
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endmacro %}
