{% props
  name = 'App',
  icon = null,
  home = null,
  dark = true,
  user = null,
  avatar = null,
  logout = null,
  class = '',
%}

{% set menu_block %}{% block menu '' %}{% endset %}
{% set header_center_block %}{% block header_center '' %}{% endset %}
{% set header_actions_block %}{% block header_actions '' %}{% endset %}
{% set sidebar_header_block %}{% block sidebar_header '' %}{% endset %}
{% set sidebar_footer_block %}{% block sidebar_footer '' %}{% endset %}
{% set user_menu_block %}{% block user_menu '' %}{% endset %}

<div
  {{ attributes }}
  data-controller="cisse--ui-bundle--base-layout"
  class="{{ ('font-sans relative flex h-screen overflow-hidden bg-gray-100 dark:bg-slate-900 ' ~ class)|tailwind_merge }}"
>
  {# Backdrop for mobile #}
  <div
    data-cisse--ui-bundle--base-layout-target="backdrop"
    data-action="click->cisse--ui-bundle--base-layout#closeSidebar"
    class="absolute z-40 h-full w-full bg-slate-950/20 lg:hidden dark:bg-white/20 hidden"
  ></div>

  {# Sidebar #}
  <twig:ui:layout:sidebar
    :name="name"
    :icon="icon"
    :home="home"
    class="{{ attributes.nested('sidebar').render('class') }}"
    :menu:class="attributes.nested('menu').render('class')"
  >
    {% block header %}
      {{ sidebar_header_block|raw }}
    {% endblock %}

    {% block menu %}
      {{ menu_block|raw }}
    {% endblock %}

    {% block footer %}
      {{ sidebar_footer_block|raw }}
    {% endblock %}
  </twig:ui:layout:sidebar>

  {# Main Content Area #}
  <div class="flex flex-1 flex-col min-w-0">
    {# Header #}
    <header class="{{ ('flex h-16 items-center justify-between border-b border-slate-200 bg-white px-4 dark:border-slate-800 dark:bg-slate-950 ' ~ attributes.nested('header').render('class'))|tailwind_merge }}" {{ attributes.nested('header').without('class') }}>
      <div>
        <button
          data-action="click->cisse--ui-bundle--base-layout#toggleSidebar"
          class="rounded-lg bg-gray-100 p-1 transition hover:bg-gray-200 dark:bg-gray-900 dark:hover:bg-gray-800"
        >
          <twig:ux:icon name="heroicons:bars-3" class="size-6 text-gray-900 dark:text-gray-100" />
        </button>
      </div>

      <div class="flex-1">
        {{ header_center_block|raw }}
      </div>

      <div class="flex items-center gap-3">
        {{ header_actions_block|raw }}

        {% if dark %}
          <button
            data-action="click->cisse--ui-bundle--base-layout#toggleDark"
            class="{{ ('flex items-center justify-center rounded-lg bg-gray-100 p-2 transition hover:bg-gray-200 dark:bg-gray-900 dark:hover:bg-gray-800 ' ~ attributes.nested('dark').render('class'))|tailwind_merge }}"
            {{ attributes.nested('dark').without('class') }}
          >
            <twig:ux:icon
              name="{{ attributes.nested('dark.sun').render('icon')|default('heroicons:sun') }}"
              data-cisse--ui-bundle--base-layout-target="sunIcon"
              class="{{ ('size-5 text-gray-900 dark:text-gray-100 hidden dark:block ' ~ attributes.nested('dark.sun').render('class'))|tailwind_merge }}"
              {{ ...attributes.nested('dark.sun').without('icon', 'class') }}
            />
            <twig:ux:icon
              name="{{ attributes.nested('dark.moon').render('icon')|default('heroicons:moon') }}"
              data-cisse--ui-bundle--base-layout-target="moonIcon"
              class="{{ ('size-5 text-gray-900 dark:text-gray-100 block dark:hidden ' ~ attributes.nested('dark.moon').render('class'))|tailwind_merge }}"
              {{ ...attributes.nested('dark.moon').without('icon', 'class') }}
            />
          </button>
        {% endif %}

        {# User Menu #}
        {% if user or avatar %}
          <div class="relative" data-controller="cisse--ui-bundle--dropdown">
            <button
              data-action="click->cisse--ui-bundle--dropdown#toggle"
              class="{{ ('flex items-center gap-2 rounded-lg p-1.5 transition hover:bg-gray-100 dark:hover:bg-gray-800 ' ~ attributes.nested('user.button').render('class'))|tailwind_merge }}"
              {{ attributes.nested('user.button').without('class') }}
            >
              <div
                class="{{ ('flex size-8 items-center justify-center rounded-full bg-primary text-sm font-medium text-primary-foreground ' ~ attributes.nested('avatar').render('class'))|tailwind_merge }}"
                {{ attributes.nested('avatar').without('class') }}
              >
                {{ avatar ?? '?' }}
              </div>
              {% if user %}
                <span
                  class="{{ ('hidden text-sm font-medium text-gray-700 dark:text-gray-300 md:block ' ~ attributes.nested('user').render('class'))|tailwind_merge }}"
                  {{ attributes.nested('user').without('class') }}
                >
                  {{ user }}
                </span>
              {% endif %}
              <twig:ux:icon
                name="{{ attributes.nested('user.chevron').render('icon')|default('heroicons:chevron-down') }}"
                class="{{ ('size-4 text-gray-500 ' ~ attributes.nested('user.chevron').render('class'))|tailwind_merge }}"
                {{ ...attributes.nested('user.chevron').without('icon', 'class') }}
              />
            </button>

            <div
              data-cisse--ui-bundle--dropdown-target="menu"
              class="{{ ('absolute right-0 mt-2 min-w-48 py-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg hidden z-50 ' ~ attributes.nested('user.menu').render('class'))|tailwind_merge }}"
              {{ attributes.nested('user.menu').without('class') }}
            >
              {{ user_menu_block|raw }}

              {% if logout %}
                {% if user_menu_block|trim %}
                  <twig:ui:dropdown:divider />
                {% endif %}
                <twig:ui:dropdown:item
                  href="{{ logout }}"
                  icon="{{ attributes.nested('logout').render('icon')|default('heroicons:arrow-right-start-on-rectangle') }}"
                  class="{{ attributes.nested('logout').render('class') }}"
                >
                  {{ attributes.nested('logout').render('label')|default('Se d√©connecter') }}
                </twig:ui:dropdown:item>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </header>

    {# Page Content #}
    <div class="ui-scrollbar flex flex-1 flex-col overflow-y-auto overflow-x-hidden">
      <main class="{{ ('container mx-auto flex flex-1 flex-col gap-5 p-5 max-w-full ' ~ attributes.nested('content').render('class'))|tailwind_merge }}" {{ attributes.nested('content').without('class') }}>
        {% block content '' %}
      </main>
    </div>
  </div>
</div>

<style>
/* Custom scrollbar styles for UI Bundle */
.ui-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: rgb(156 163 175 / 0.5) transparent;
}
.ui-scrollbar::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}
.ui-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}
.ui-scrollbar::-webkit-scrollbar-thumb {
  background: rgb(156 163 175 / 0.5);
  border-radius: 9999px;
}
.ui-scrollbar::-webkit-scrollbar-thumb:hover {
  background: rgb(156 163 175 / 0.7);
}

/* Dark variant for dark backgrounds (sidebar) */
.ui-scrollbar-dark {
  scrollbar-width: thin;
  scrollbar-color: rgb(255 255 255 / 0.2) transparent;
}
.ui-scrollbar-dark::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}
.ui-scrollbar-dark::-webkit-scrollbar-track {
  background: transparent;
}
.ui-scrollbar-dark::-webkit-scrollbar-thumb {
  background: rgb(255 255 255 / 0.2);
  border-radius: 9999px;
}
.ui-scrollbar-dark::-webkit-scrollbar-thumb:hover {
  background: rgb(255 255 255 / 0.4);
}

/* Dark mode variant for light backgrounds */
.dark .ui-scrollbar {
  scrollbar-color: rgb(100 116 139 / 0.5) transparent;
}
.dark .ui-scrollbar::-webkit-scrollbar-thumb {
  background: rgb(100 116 139 / 0.5);
}
.dark .ui-scrollbar::-webkit-scrollbar-thumb:hover {
  background: rgb(100 116 139 / 0.7);
}
</style>
