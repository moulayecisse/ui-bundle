{% props
    class = '',
    title = '',
    description = '',
    content = '',
    divide = false,
    tag = 'div',
    loading = false,
    loadingLines = 3,
    loadingAvatar = false,
    loadingActions = false,
    icon = '',
%}

{% set cardTitleBlock %}{% block title title|raw %}{% endset %}
{% set cardDescriptionBlock %}{% block description description|raw %}{% endset %}
{% set cardActionsBlock %}{% block actions '' %}{% endset %}
{% set cardHeaderBlock %}{% block header '' %}{% endset %}
{% set cardContentBlock %}{% block content '' %}{% endset %}
{% set cardFooterBlock %}{% block footer '' %}{% endset %}
{% set showHeader = cardTitleBlock|trim or cardDescriptionBlock|trim or cardActionsBlock|trim or cardHeaderBlock|trim %}
{% set showFooter = cardFooterBlock|trim != '' %}

{# Loading state - render skeleton #}
{% if loading %}
    <twig:ui:card-skeleton
        :showAvatar="loadingAvatar"
        :lines="loadingLines"
        :showActions="loadingActions"
        class="{{ class }}"
    />
{% else %}
    <{{ tag }}
        {{ attributes }}
        class="{{ ('flex flex-col rounded-lg bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 ' ~ class)|tailwind_merge }}"
    >
        {% block wrapper %}
            {% if showHeader %}
                {% if cardHeaderBlock|trim %}
                    {{ cardHeaderBlock|raw }}
                {% else %}
                    <twig:ui:card:header {{ ...attributes.nested('header') }}>
                        {% if icon %}
                            {% set iconClasses = attributes.nested('icon').render('class')|default('text-gray-400') %}
                            <div class="flex items-center gap-3">
                                <twig:ux:icon :name="icon" class="{{ ('size-8 flex-shrink-0 ' ~ iconClasses)|tailwind_merge }}" />
                                <div class="flex flex-col flex-1 min-w-0">
                                    <twig:ui:card:title {{ ...attributes.nested('title') }}>{{ cardTitleBlock|raw }}</twig:ui:card:title>
                                    <twig:ui:card:description {{ ...attributes.nested('description') }}>{{ cardDescriptionBlock|raw }}</twig:ui:card:description>
                                </div>
                            </div>
                        {% else %}
                            <twig:ui:card:title {{ ...attributes.nested('title') }}>{{ cardTitleBlock|raw }}</twig:ui:card:title>
                            <twig:ui:card:description {{ ...attributes.nested('description') }}>{{ cardDescriptionBlock|raw }}</twig:ui:card:description>
                        {% endif %}

                        <twig:block name="actions">
                            <twig:ui:card:actions {{ ...attributes.nested('actions') }}>{{ cardActionsBlock|raw }}</twig:ui:card:actions>
                        </twig:block>
                    </twig:ui:card:header>
                {% endif %}
            {% endif %}

            {% if divide and showHeader %}
                <twig:ui:divider />
            {% endif %}

            <twig:ui:card:content {{ ...attributes.nested('content') }}>
                {{ cardContentBlock|raw }}
            </twig:ui:card:content>

            {% if divide and showFooter %}
                <twig:ui:divider />
            {% endif %}

            {% if showFooter %}
                <twig:ui:card:footer {{ ...attributes.nested('footer') }}>
                    {{ cardFooterBlock|raw }}
                </twig:ui:card:footer>
            {% endif %}
        {% endblock %}
    </{{ tag }}>
{% endif %}
