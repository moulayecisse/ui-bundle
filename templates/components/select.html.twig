{% props
    type = 'text',
    form = null,
    class = '',
    value = null,
    name = null,
    id = null,
    placeholder = 'Select an option',
    required = false,
    autofocus = false,
    autocomplete = null,
    disabled = false,
    invalid = false,
    size = 'md',
    options = [],
    icon = null,
    multiple = false,
    variant = 'default',
%}

{% set _id = id ?? name %}

{% if form %}
    {% set value = value ?? field_value(form) %}
    {% set name = name ?? field_name(form) %}
    {% set _id = _id ?? form.vars.id %}
    {% set required = required ?? form.vars.required %}
    {% set disabled = disabled ?? form.vars.disabled %}
{% endif %}

{# Size classes #}
{% set sizeClasses = {
    'sm': { padding: 'py-1.5 text-xs', icon: 'size-4', iconPadding: 'pl-8' },
    'md': { padding: 'py-2 text-sm', icon: 'size-5', iconPadding: 'pl-10' },
    'lg': { padding: 'py-2.5 text-base', icon: 'size-6', iconPadding: 'pl-12' },
} %}

{% set sizes = sizeClasses[size] ?? sizeClasses['md'] %}

{# Variant classes #}
{% set variantClasses = {
    'default': '',
    'filled': 'bg-gray-100 dark:bg-gray-800 border-transparent',
    'underline': 'rounded-none border-x-0 border-t-0 border-b-2',
} %}

{% set content_block %}{% block content %}
    {% if placeholder and not multiple %}
        <option value="" {% if value is null or value == '' %}selected{% endif %} disabled>{{ placeholder }}</option>
    {% endif %}
    {% for option in options %}
        {% set optionValue = option.value ?? option %}
        {% set isSelected = multiple ? (optionValue in value) : (optionValue == value) %}
        <option
            value="{{ optionValue }}"
            {% if isSelected %}selected{% endif %}
            {% if option.disabled is defined and option.disabled %}disabled{% endif %}
        >
            {{ option.label ?? option }}
        </option>
    {% endfor %}
{% endblock %}{% endset %}

<twig:ui:input-wrapper :class="class" :disabled="disabled" :invalid="invalid">
    <div class="w-full grid grid-cols-1">
        {# Leading icon #}
        {% if icon %}
            <twig:ux:icon
                :name="icon"
                class="pointer-events-none col-start-1 row-start-1 ml-3 {{ sizes.icon }} self-center justify-self-start text-gray-500 dark:text-gray-400 z-10"
            />
        {% endif %}

        <select
            {{ attributes }}
            {% if name %}name="{{ name }}{% if multiple %}[]{% endif %}"{% endif %}
            {% if _id %}id="{{ _id }}"{% endif %}
            {% if autocomplete %}autocomplete="{{ autocomplete }}"{% endif %}
            {{ required ? 'required' }}
            {{ autofocus ? 'autofocus' }}
            {{ disabled ? 'disabled' }}
            {{ multiple ? 'multiple' }}
            data-size="{{ size }}"
            data-variant="{{ variant }}"
            class="col-start-1 row-start-1 w-full appearance-none pr-10 {{ icon ? sizes.iconPadding : 'pl-3' }} bg-transparent focus:outline-none cursor-pointer {{ sizes.padding }} {{ variantClasses[variant] ?? '' }} {{ invalid ? 'border-red-500 focus:ring-red-500' : '' }}"
        >
            {{ content_block|raw }}
        </select>

        {# Dropdown icon #}
        {% if not multiple %}
            <twig:ux:icon
                name="heroicons:chevron-down"
                class="pointer-events-none col-start-1 row-start-1 mr-3 {{ sizes.icon }} self-center justify-self-end text-gray-500 dark:text-gray-400"
            />
        {% endif %}
    </div>
</twig:ui:input-wrapper>
