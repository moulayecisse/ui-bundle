{% props
  open = false,
  title = 'Confirm',
  message = 'Are you sure you want to proceed?',
  confirmText = 'Confirm',
  cancelText = 'Cancel',
  variant = 'info',
  size = 'sm',
  loading = false,
  icon = null,
  hideIcon = false,
  centered = true,
  class = '',
  formId = null,
%}

{# Nested attributes for fine-grained customization #}
{% set iconAttrs = attributes.nested('icon') %}
{% set titleAttrs = attributes.nested('title') %}
{% set messageAttrs = attributes.nested('message') %}
{% set actionsAttrs = attributes.nested('actions') %}
{% set cancelAttrs = attributes.nested('cancel') %}
{% set confirmAttrs = attributes.nested('confirm') %}

{% set variantConfig = {
  'info': { icon: 'lucide:info', iconClass: 'text-blue-500', buttonClass: 'bg-primary-500 hover:bg-primary-600 text-white' },
  'warning': { icon: 'lucide:alert-triangle', iconClass: 'text-yellow-500', buttonClass: 'bg-primary-500 hover:bg-primary-600 text-white' },
  'danger': { icon: 'lucide:alert-circle', iconClass: 'text-red-500', buttonClass: 'bg-red-500 hover:bg-red-600 text-white' },
  'success': { icon: 'lucide:check-circle', iconClass: 'text-green-500', buttonClass: 'bg-green-500 hover:bg-green-600 text-white' },
} %}

{% set config = variantConfig[variant] ?? variantConfig['info'] %}
{% set iconName = icon ?? config.icon %}

{% set iconSizeConfig = {
  'sm': { wrapper: 'size-12', icon: 'size-6' },
  'default': { wrapper: 'size-14', icon: 'size-8' },
  'lg': { wrapper: 'size-16', icon: 'size-10' },
} %}
{% set currentIconSize = iconSizeConfig[size] ?? iconSizeConfig['default'] %}

{% set triggerContent %}{% block content '' %}{% endset %}

<twig:ui:modal :open="open" :size="size" :centered="centered" hideCloseButton>
  <twig:block name="trigger">{{ triggerContent|raw }}</twig:block>
  <div class="{{ centered ? 'text-center' : '' }} {{ class }}">
    {# Icon #}
    {% if not hideIcon %}
      <div class="{{ ((centered ? 'mx-auto' : '') ~ ' mb-4 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800 ' ~ currentIconSize.wrapper ~ ' ' ~ iconAttrs.render('class'))|tailwind_merge }}" {{ iconAttrs.without('class') }}>
        <twig:ux:icon :name="iconName" class="{{ currentIconSize.icon }} {{ config.iconClass }}" />
      </div>
    {% endif %}

    {# Title #}
    <h3 class="{{ ('mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100 ' ~ titleAttrs.render('class'))|tailwind_merge }}" {{ titleAttrs.without('class') }}>
      {{ title }}
    </h3>

    {# Message #}
    <p class="{{ ('mb-6 text-gray-600 dark:text-gray-400 ' ~ messageAttrs.render('class'))|tailwind_merge }}" {{ messageAttrs.without('class') }}>
      {{ message }}
    </p>

    {# Actions #}
    <div class="{{ ('flex gap-3 ' ~ (centered ? 'justify-center' : 'justify-end') ~ ' ' ~ actionsAttrs.render('class'))|tailwind_merge }}" {{ actionsAttrs.without('class') }}>
      <twig:ui:button
        type="button"
        class="{{ ('border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 ' ~ cancelAttrs.render('class'))|tailwind_merge }}"
        :disabled="loading"
        data-action="click->cisse--ui-bundle--modal#close"
        {{ ...cancelAttrs.without('class') }}
      >
        {{ cancelText }}
      </twig:ui:button>
      <button
        type="submit"
        class="{{ ('inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 px-4 py-2 ' ~ config.buttonClass ~ ' ' ~ confirmAttrs.render('class'))|tailwind_merge }}"
        {{ confirmAttrs.without('class') }}
        {{ loading ? 'disabled' }}
        {% if formId %}form="{{ formId }}"{% endif %}
      >
        {% if loading %}
          <twig:ux:icon name="lucide:loader-2" class="size-4 animate-spin mr-2" />
        {% endif %}
        {{ confirmText }}
      </button>
    </div>
  </div>
</twig:ui:modal>
