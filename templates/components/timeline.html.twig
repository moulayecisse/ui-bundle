{% props
  items = [],
  orientation = 'vertical',
  class = '',
%}

{# Status classes mapping #}
{% set statusClasses = {
  'completed': { dot: 'bg-green-500', line: 'bg-green-500', icon: 'text-white' },
  'current': { dot: 'bg-primary-500 ring-4 ring-primary-100 dark:ring-primary-900', line: 'bg-gray-200 dark:bg-gray-700', icon: 'text-white' },
  'error': { dot: 'bg-red-500', line: 'bg-red-500', icon: 'text-white' },
  'upcoming': { dot: 'bg-gray-300 dark:bg-gray-600', line: 'bg-gray-200 dark:bg-gray-700', icon: 'text-gray-500 dark:text-gray-400' },
} %}

{# Default icons for statuses #}
{% set defaultIcons = {
  'completed': 'heroicons:check',
  'error': 'heroicons:x-mark',
} %}

{% if orientation == 'vertical' %}
  {# Vertical Timeline #}
  <div {{ attributes }} class="{{ ('relative ' ~ class)|tailwind_merge }}">
    {% for item in items %}
      {% set status = item.status ?? 'upcoming' %}
      {% set classes = statusClasses[status] ?? statusClasses['upcoming'] %}
      {% set icon = item.icon ?? defaultIcons[status] ?? null %}

      <div class="relative pb-8 last:pb-0">
        {# Connecting line #}
        {% if not loop.last %}
          <div class="absolute left-4 top-8 w-0.5 h-full -ml-px {{ classes.line }}"></div>
        {% endif %}

        <div class="flex items-start gap-4">
          {# Dot/Icon #}
          <div class="relative z-10 flex items-center justify-center size-8 rounded-full shrink-0 {{ classes.dot }}">
            {% if icon %}
              <twig:ux:icon :name="icon" class="size-4 {{ classes.icon }}" />
            {% endif %}
          </div>

          {# Content #}
          <div class="flex-1 min-w-0 pt-0.5">
            <div class="flex items-center justify-between gap-2">
              <h3 class="text-sm font-medium text-gray-900 dark:text-white">
                {{ item.title ?? '' }}
              </h3>
              {% if item.date is defined and item.date %}
                <time class="text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap">
                  {{ item.date }}
                </time>
              {% endif %}
            </div>
            {% if item.description is defined and item.description %}
              <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
                {{ item.description }}
              </p>
            {% endif %}

            {# Custom block for each item #}
            {% set itemBlockName = 'item_' ~ loop.index %}
            {% if block(itemBlockName) is defined %}
              {{ block(itemBlockName) }}
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}

    {% block content '' %}
  </div>
{% else %}
  {# Horizontal Timeline #}
  <div {{ attributes }} class="{{ ('flex items-start overflow-x-auto pb-4 ' ~ class)|tailwind_merge }}">
    {% for item in items %}
      {% set status = item.status ?? 'upcoming' %}
      {% set classes = statusClasses[status] ?? statusClasses['upcoming'] %}
      {% set icon = item.icon ?? defaultIcons[status] ?? null %}

      <div class="flex flex-col items-center shrink-0 {{ not loop.last ? 'flex-1' : '' }}">
        <div class="flex items-center w-full">
          {# Dot/Icon #}
          <div class="relative z-10 flex items-center justify-center size-8 rounded-full shrink-0 {{ classes.dot }}">
            {% if icon %}
              <twig:ux:icon :name="icon" class="size-4 {{ classes.icon }}" />
            {% endif %}
          </div>

          {# Connecting line #}
          {% if not loop.last %}
            <div class="flex-1 h-0.5 mx-2 {{ classes.line }}"></div>
          {% endif %}
        </div>

        {# Content #}
        <div class="mt-2 text-center max-w-[120px]">
          <h3 class="text-xs font-medium text-gray-900 dark:text-white">
            {{ item.title ?? '' }}
          </h3>
          {% if item.date is defined and item.date %}
            <time class="text-xs text-gray-500 dark:text-gray-400">
              {{ item.date }}
            </time>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}
