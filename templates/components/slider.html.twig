{% props
  name = null,
  id = null,
  value = 0,
  min = 0,
  max = 100,
  step = 1,
  disabled = false,
  showValue = false,
  showMinMax = true,
  size = 'md',
  color = 'primary',
  showTicks = false,
  tickCount = 5,
  valueFormat = null,
  class = '',
%}

{# Nested attributes for fine-grained customization #}
{% set inputAttrs = attributes.nested('input') %}
{% set trackAttrs = attributes.nested('track') %}
{% set valueAttrs = attributes.nested('value') %}
{% set ticksAttrs = attributes.nested('ticks') %}

{% set percentage = ((value - min) / (max - min)) * 100 %}

{% set sizeConfig = {
  'sm': { track: 'h-1', thumb: 'size-4', text: 'text-xs', margin: '-0.25rem' },
  'md': { track: 'h-2', thumb: 'size-5', text: 'text-sm', margin: '-0.375rem' },
  'lg': { track: 'h-3', thumb: 'size-6', text: 'text-base', margin: '-0.375rem' },
} %}

{% set colorConfig = {
  'primary': 'bg-primary',
  'secondary': 'bg-secondary',
  'success': 'bg-green-500',
  'warning': 'bg-yellow-500',
  'danger': 'bg-red-500',
  'info': 'bg-blue-500',
} %}

{% set currentSize = sizeConfig[size] ?? sizeConfig['md'] %}
{% set currentColor = colorConfig[color] ?? colorConfig['primary'] %}

{% set formattedValue = valueFormat ? valueFormat|replace({'%value%': value}) : value %}

<div {{ attributes }} class="{{ ('w-full ' ~ class)|tailwind_merge }}" data-size="{{ size }}" data-color="{{ color }}">
  {% if showValue or showMinMax %}
    <div class="{{ ('mb-2 flex justify-between ' ~ currentSize.text ~ ' ' ~ valueAttrs.render('class'))|tailwind_merge }}" {{ valueAttrs.without('class') }}>
      {% if showMinMax %}
        <span class="text-gray-600 dark:text-gray-400">{{ min }}</span>
      {% endif %}
      {% if showValue %}
        <span class="font-medium text-gray-900 dark:text-white">{{ formattedValue }}</span>
      {% endif %}
      {% if showMinMax %}
        <span class="text-gray-600 dark:text-gray-400">{{ max }}</span>
      {% endif %}
    </div>
  {% endif %}

  <div class="relative">
    <input
      type="range"
      {% if name %}name="{{ name }}"{% endif %}
      {% if id %}id="{{ id }}"{% endif %}
      value="{{ value }}"
      min="{{ min }}"
      max="{{ max }}"
      step="{{ step }}"
      {{ disabled ? 'disabled' }}
      class="{{ ('slider-input slider-input-' ~ size ~ ' w-full cursor-pointer appearance-none bg-transparent disabled:cursor-not-allowed disabled:opacity-50 ' ~ inputAttrs.render('class'))|tailwind_merge }}"
      {{ inputAttrs.without('class') }}
    >
    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center" style="top: 50%; transform: translateY(-50%);">
      <div
        class="{{ (currentSize.track ~ ' rounded-full ' ~ currentColor ~ ' ' ~ trackAttrs.render('class'))|tailwind_merge }}"
        {{ trackAttrs.without('class') }}
        style="width: {{ percentage }}%;"
      ></div>
    </div>
  </div>

  {% if showTicks %}
    <div class="{{ ('flex justify-between mt-1 px-1 ' ~ ticksAttrs.render('class'))|tailwind_merge }}" {{ ticksAttrs.without('class') }}>
      {% for i in 0..tickCount - 1 %}
        {% set tickValue = min + ((max - min) / (tickCount - 1)) * i %}
        <span class="text-xs text-gray-400 dark:text-gray-500">{{ tickValue|round }}</span>
      {% endfor %}
    </div>
  {% endif %}
</div>

<style>
.slider-input-sm { height: 0.25rem; }
.slider-input-md { height: 0.5rem; }
.slider-input-lg { height: 0.75rem; }

.slider-input::-webkit-slider-runnable-track {
  border-radius: 9999px;
  background-color: #e5e7eb;
}
.slider-input-sm::-webkit-slider-runnable-track { height: 0.25rem; }
.slider-input-md::-webkit-slider-runnable-track { height: 0.5rem; }
.slider-input-lg::-webkit-slider-runnable-track { height: 0.75rem; }

.dark .slider-input::-webkit-slider-runnable-track {
  background-color: #374151;
}

.slider-input::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  border-radius: 9999px;
  background-color: var(--color-primary, #3b82f6);
  border: 2px solid white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  cursor: pointer;
}
.slider-input-sm::-webkit-slider-thumb { width: 1rem; height: 1rem; margin-top: -0.375rem; }
.slider-input-md::-webkit-slider-thumb { width: 1.25rem; height: 1.25rem; margin-top: -0.375rem; }
.slider-input-lg::-webkit-slider-thumb { width: 1.5rem; height: 1.5rem; margin-top: -0.375rem; }

.slider-input::-moz-range-track {
  border-radius: 9999px;
  background-color: #e5e7eb;
}
.slider-input-sm::-moz-range-track { height: 0.25rem; }
.slider-input-md::-moz-range-track { height: 0.5rem; }
.slider-input-lg::-moz-range-track { height: 0.75rem; }

.dark .slider-input::-moz-range-track {
  background-color: #374151;
}

.slider-input::-moz-range-thumb {
  border-radius: 9999px;
  background-color: var(--color-primary, #3b82f6);
  border: 2px solid white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  cursor: pointer;
}
.slider-input-sm::-moz-range-thumb { width: 1rem; height: 1rem; }
.slider-input-md::-moz-range-thumb { width: 1.25rem; height: 1.25rem; }
.slider-input-lg::-moz-range-thumb { width: 1.5rem; height: 1.5rem; }

.slider-input:focus::-webkit-slider-thumb {
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
}

.slider-input:focus::-moz-range-thumb {
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
}

[data-color="success"] .slider-input::-webkit-slider-thumb { background-color: #22c55e; }
[data-color="warning"] .slider-input::-webkit-slider-thumb { background-color: #eab308; }
[data-color="danger"] .slider-input::-webkit-slider-thumb { background-color: #ef4444; }
[data-color="info"] .slider-input::-webkit-slider-thumb { background-color: #3b82f6; }
[data-color="success"] .slider-input::-moz-range-thumb { background-color: #22c55e; }
[data-color="warning"] .slider-input::-moz-range-thumb { background-color: #eab308; }
[data-color="danger"] .slider-input::-moz-range-thumb { background-color: #ef4444; }
[data-color="info"] .slider-input::-moz-range-thumb { background-color: #3b82f6; }
</style>
