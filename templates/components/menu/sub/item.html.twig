{# templates/components/Ui/menu/sub/item.html.twig #}
{% props
    active = null,
    href = null,
    label = null,
    icon = null,
    badge = null,
    badgeVariant = 'default',
    count = null,
    disabled = false,
    class = '',
%}

{% set rightBlock %}{% block right '' %}{% endset %}
{% set hasRightSlot = rightBlock is not empty or badge or count is not null %}

{# This component renders differently in inline submenu vs flyout #}
{#
  Inline submenu (in sidebar): dark background -> light text
  Flyout (collapsed mode): light background -> dark text
  Uses [[data-flyout-children]_&] arbitrary variant to detect flyout context
#}
<li
    {{ attributes.without('class') }}
    data-active="{{ active ? 'true' : 'false' }}"
    class="group/sub {{ attributes.render('class') }}"
>
    <a
        href="{{ href ?? '#' }}"
        class="flex items-center gap-3 px-4 py-2 text-sm rounded-md transition-colors {{ disabled ? 'opacity-50 pointer-events-none' : '' }} {{ active ? 'text-primary-400 bg-white/10 [[data-flyout-children]_&]:bg-primary/10 [[data-flyout-children]_&]:text-primary' : 'text-white/70 hover:text-white hover:bg-white/10 [[data-flyout-children]_&]:text-gray-700 [[data-flyout-children]_&]:hover:bg-gray-100 [[data-flyout-children]_&]:hover:text-gray-900 dark:[[data-flyout-children]_&]:text-gray-300 dark:[[data-flyout-children]_&]:hover:bg-gray-700 dark:[[data-flyout-children]_&]:hover:text-white' }}"
        {% if disabled %}aria-disabled="true"{% endif %}
    >
        {% block content %}
            {# Icon #}
            {% if icon %}
                {% set iconClass = ('size-4 shrink-0 ' ~ attributes.nested('icon').render('class'))|tailwind_merge %}
                <twig:ux:icon
                    name="{{ icon }}"
                    class="{{ iconClass }}"
                />
            {% endif %}

            {# Label #}
            {% set labelClass = ('flex-1 ' ~ attributes.nested('label').render('class'))|tailwind_merge %}
            <span class="{{ labelClass }}" {{ attributes.nested('label').without('class') }}>
                {% block label label %}
            </span>

            {# Right slot: badge, count, or custom content #}
            {% if hasRightSlot %}
                <span class="flex items-center gap-2">
                    {% if rightBlock is not empty %}
                        {{ rightBlock|raw }}
                    {% endif %}

                    {% if badge %}
                        <twig:ui:badge variant="{{ badgeVariant }}" size="sm">{{ badge }}</twig:ui:badge>
                    {% endif %}

                    {% if count is not null %}
                        <span class="text-xs font-medium {{ active ? 'text-primary-400 [[data-flyout-children]_&]:text-primary/80' : 'text-white/50 [[data-flyout-children]_&]:text-gray-500' }}">
                            {{ count }}
                        </span>
                    {% endif %}
                </span>
            {% endif %}
        {% endblock %}
    </a>
</li>
