{# templates/components/Ui/responsive-list.html.twig #}
{# Responsive list that shows table on desktop, cards on mobile #}
{% props
    class = '',
    items = [],
    fields = [],
    keyField = 'id',
    selectable = false,
    showActions = false,
    loading = false,
    loadingRows = 5,
    breakpoint = 'md',
    emptyLabel = 'No items found'
%}

{% set class = (class)|tailwind_merge %}

<div
    {{ attributes }}
    data-controller="cisse--ui-bundle--responsive-list"
    class="{{ class }}"
>
    {# Desktop: Table view #}
    <div class="hidden {{ breakpoint }}:block">
        <twig:ui:table:selectable
            :fields="fields"
            :items="items"
            :selectable="selectable"
            :showActions="showActions"
            :emptyLabel="emptyLabel"
        >
            {% block thead '' %}
            {% block tbody '' %}
            {% block tfoot '' %}
            {% block batch_actions '' %}
            {% block tbody_actions '' %}
            {% block empty '' %}
        </twig:ui:table:selectable>
    </div>

    {# Mobile: Card view #}
    <div class="{{ breakpoint }}:hidden">
        {% if loading %}
            <twig:ui:card>
                <twig:ui:skeleton:list :items="loadingRows" showAvatar showSecondary showAction />
            </twig:ui:card>
        {% elseif items|length == 0 %}
            {% set emptyBlock %}{% block mobile_empty '' %}{% endset %}
            {% if emptyBlock is not empty %}
                {{ emptyBlock|raw }}
            {% else %}
                <twig:ui:card>
                    <div class="p-8 text-center">
                        <twig:ux:icon name="heroicons:inbox-20-solid" class="size-12 mx-auto text-gray-300 dark:text-gray-600" />
                        <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">{{ emptyLabel }}</p>
                    </div>
                </twig:ui:card>
            {% endif %}
        {% else %}
            <div class="space-y-3">
                {% for item in items %}
                    {% set itemId = attribute(item, keyField) ?? loop.index0 %}

                    <twig:ui:card class="hover:shadow-lg transition-all duration-200">
                        <div class="p-4">
                            {# Mobile card content slot #}
                            {% set mobileContentBlock %}{% block mobile_content '' %}{% endset %}
                            {% if mobileContentBlock is not empty %}
                                {{ mobileContentBlock|raw }}
                            {% else %}
                                {# Default: Show fields as key-value pairs #}
                                <dl class="space-y-2">
                                    {% for field in fields %}
                                        {% set fieldName = field.name ?? field %}
                                        {% set fieldLabel = field.label ?? fieldName %}
                                        {% set fieldValue = attribute(item, fieldName) ?? '' %}

                                        <div class="flex justify-between items-center">
                                            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ fieldLabel }}</dt>
                                            <dd class="text-sm text-gray-900 dark:text-gray-100">{{ fieldValue }}</dd>
                                        </div>
                                    {% endfor %}
                                </dl>
                            {% endif %}

                            {# Mobile actions #}
                            {% if showActions %}
                                <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-800 flex justify-end gap-2">
                                    {% block mobile_actions '' %}
                                </div>
                            {% endif %}
                        </div>
                    </twig:ui:card>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
