{# Responsive list that shows table on desktop, cards on mobile #}
{% props
    class = '',
    items = [],
    fields = [],
    keyField = 'id',
    selectable = false,
    showActions = false,
    loading = false,
    loadingRows = 5,
    breakpoint = 'md',
    emptyLabel = 'No items found'
%}

{# Capture all blocks at the top level (outside any loops/conditionals) #}
{% set theadBlock %}{% block thead '' %}{% endset %}
{% set tbodyBlock %}{% block tbody '' %}{% endset %}
{% set tfootBlock %}{% block tfoot '' %}{% endset %}
{% set batchActionsBlock %}{% block batch_actions '' %}{% endset %}
{% set tbodyActionsBlock %}{% block tbody_actions '' %}{% endset %}
{% set emptyBlock %}{% block empty '' %}{% endset %}
{% set mobileEmptyBlock %}{% block mobile_empty '' %}{% endset %}
{% set mobileContentBlock %}{% block mobile_content '' %}{% endset %}
{% set mobileActionsBlock %}{% block mobile_actions '' %}{% endset %}

{% set class = (class)|tailwind_merge %}

<div
    {{ attributes }}
    data-controller="cisse--ui-bundle--responsive-list"
    class="{{ class }}"
>
    {# Desktop: Table view #}
    <div class="hidden {{ breakpoint }}:block">
        {% if loading %}
            <twig:ui:card>
                <twig:ui:skeleton:table rows="5" cols="4" />
            </twig:ui:card>
        {% else %}
            <twig:ui:table:selectable
                :fields="fields"
                :items="items"
                :selectable="selectable"
                :showActions="showActions"
                :emptyLabel="emptyLabel"
            >
                <twig:block name="thead">{{ theadBlock|raw }}</twig:block>
                <twig:block name="tbody">{{ tbodyBlock|raw }}</twig:block>
                <twig:block name="tfoot">{{ tfootBlock|raw }}</twig:block>
                <twig:block name="batch_actions">{{ batchActionsBlock|raw }}</twig:block>
                <twig:block name="tbody_actions">{{ tbodyActionsBlock|raw }}</twig:block>
                <twig:block name="empty">{{ emptyBlock|raw }}</twig:block>
            </twig:ui:table:selectable>
        {% endif %}
    </div>

    {# Mobile: Card view #}
    <div class="{{ breakpoint }}:hidden">
        {% if loading %}
            <twig:ui:card>
                <twig:ui:skeleton:list :items="loadingRows" showAvatar showSecondary showAction />
            </twig:ui:card>
        {% elseif items|length == 0 %}
            {% if mobileEmptyBlock|trim %}
                {{ mobileEmptyBlock|raw }}
            {% else %}
                <twig:ui:card>
                    <div class="p-8 text-center">
                        <twig:ux:icon name="heroicons:inbox-20-solid" class="size-12 mx-auto text-gray-300 dark:text-gray-600" />
                        <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">{{ emptyLabel }}</p>
                    </div>
                </twig:ui:card>
            {% endif %}
        {% else %}
            <div class="space-y-3">
                {% for item in items %}
                    {% set itemId = attribute(item, keyField) ?? loop.index0 %}

                    <twig:ui:card class="hover:shadow-lg transition-all duration-200">
                        <div class="p-4">
                            {# Mobile card content #}
                            {% if mobileContentBlock|trim %}
                                {{ mobileContentBlock|raw }}
                            {% else %}
                                {# Default: Show fields as key-value pairs #}
                                <dl class="space-y-2">
                                    {% for field in fields %}
                                        {% set fieldName = field.name ?? field %}
                                        {% set fieldLabel = field.label ?? fieldName %}
                                        {% set fieldValue = attribute(item, fieldName) ?? '' %}

                                        <div class="flex justify-between items-center">
                                            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ fieldLabel }}</dt>
                                            <dd class="text-sm text-gray-900 dark:text-gray-100">{{ fieldValue }}</dd>
                                        </div>
                                    {% endfor %}
                                </dl>
                            {% endif %}

                            {# Mobile actions #}
                            {% if showActions and mobileActionsBlock|trim %}
                                <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-800 flex justify-end gap-2">
                                    {{ mobileActionsBlock|raw }}
                                </div>
                            {% endif %}
                        </div>
                    </twig:ui:card>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
