{% props
  name = null,
  id = null,
  value = '',
  placeholder = 'Enter email address...',
  size = 'md',
  disabled = false,
  showValidation = true,
  required = false,
  class = '',
%}

{# Nested attributes for fine-grained customization #}
{% set wrapperAttrs = attributes.nested('wrapper') %}
{% set iconAttrs = attributes.nested('icon') %}
{% set inputAttrs = attributes.nested('input') %}

{% set sizeClasses = {
  'sm': { 'wrapper': 'h-8 px-2 gap-2', 'icon': 'size-4', 'input': 'text-sm' },
  'md': { 'wrapper': 'h-10 px-3 gap-2', 'icon': 'size-5', 'input': 'text-base' },
  'lg': { 'wrapper': 'h-12 px-4 gap-3', 'icon': 'size-6', 'input': 'text-lg' },
} %}

{% set currentSize = sizeClasses[size] ?? sizeClasses['md'] %}

<div
  {{ attributes }}
  data-controller="cisse--ui-bundle--email-input"
  data-cisse--ui-bundle--email-input-show-validation-value="{{ showValidation ? 'true' : 'false' }}"
  class="{{ ('flex items-center rounded-lg border border-gray-300 bg-white focus-within:ring-2 focus-within:ring-primary-500 focus-within:border-transparent dark:border-gray-600 dark:bg-gray-800 ' ~ currentSize.wrapper ~ ' ' ~ (disabled ? 'bg-gray-100 dark:bg-gray-900 cursor-not-allowed opacity-60' : '') ~ ' ' ~ class ~ ' ' ~ wrapperAttrs.render('class'))|tailwind_merge }}"
>
  {# Icon #}
  <twig:ux:icon name="heroicons:envelope" class="{{ (currentSize.icon ~ ' text-gray-400 shrink-0 ' ~ iconAttrs.render('class'))|tailwind_merge }}" {{ ...iconAttrs.without('class') }} />

  {# Input #}
  <input
    data-cisse--ui-bundle--email-input-target="input"
    type="email"
    {% if name %}name="{{ name }}"{% endif %}
    {% if id %}id="{{ id }}"{% elseif name %}id="{{ name }}"{% endif %}
    value="{{ value }}"
    placeholder="{{ placeholder }}"
    {{ disabled ? 'disabled' }}
    {{ required ? 'required' }}
    class="{{ ('flex-1 bg-transparent border-none focus:outline-none text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 ' ~ currentSize.input ~ ' ' ~ inputAttrs.render('class'))|tailwind_merge }}"
    {{ inputAttrs.without('class') }}
    data-action="blur->cisse--ui-bundle--email-input#handleBlur input->cisse--ui-bundle--email-input#handleInput"
  >

  {# Validation icon #}
  <div data-cisse--ui-bundle--email-input-target="status" class="shrink-0 hidden">
    <twig:ux:icon name="heroicons:check-circle" data-icon="valid" class="size-5 text-emerald-500 hidden" />
    <twig:ux:icon name="heroicons:exclamation-circle" data-icon="invalid" class="size-5 text-red-500 hidden" />
  </div>
</div>
