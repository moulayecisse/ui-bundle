{% props
  name = null,
  id = null,
  value = '',
  placeholder = 'Enter password...',
  size = 'md',
  disabled = false,
  showStrength = false,
  minLength = 8,
  required = false,
  autocomplete = 'new-password',
  class = '',
%}

{# Nested attributes for fine-grained customization #}
{% set wrapperAttrs = attributes.nested('wrapper') %}
{% set iconAttrs = attributes.nested('icon') %}
{% set inputAttrs = attributes.nested('input') %}
{% set toggleAttrs = attributes.nested('toggle') %}
{% set strengthAttrs = attributes.nested('strength') %}

{% set sizeClasses = {
  'sm': { 'wrapper': 'h-8 px-2 gap-2', 'icon': 'size-4', 'input': 'text-sm' },
  'md': { 'wrapper': 'h-10 px-3 gap-2', 'icon': 'size-5', 'input': 'text-base' },
  'lg': { 'wrapper': 'h-12 px-4 gap-3', 'icon': 'size-6', 'input': 'text-lg' },
} %}

{% set currentSize = sizeClasses[size] ?? sizeClasses['md'] %}

<div
  {{ attributes }}
  data-controller="cisse--ui-bundle--password-input"
  data-cisse--ui-bundle--password-input-show-strength-value="{{ showStrength ? 'true' : 'false' }}"
  data-cisse--ui-bundle--password-input-min-length-value="{{ minLength }}"
>
  <div class="{{ ('flex items-center rounded-lg border border-gray-300 bg-white focus-within:ring-2 focus-within:ring-primary-500 focus-within:border-transparent dark:border-gray-600 dark:bg-gray-800 ' ~ currentSize.wrapper ~ ' ' ~ (disabled ? 'bg-gray-100 dark:bg-gray-900 cursor-not-allowed opacity-60' : '') ~ ' ' ~ class ~ ' ' ~ wrapperAttrs.render('class'))|tailwind_merge }}" {{ wrapperAttrs.without('class') }}>
    {# Icon #}
    <twig:ux:icon name="heroicons:lock-closed" class="{{ (currentSize.icon ~ ' text-gray-400 shrink-0 ' ~ iconAttrs.render('class'))|tailwind_merge }}" {{ ...iconAttrs.without('class') }} />

    {# Input #}
    <input
      data-cisse--ui-bundle--password-input-target="input"
      type="password"
      {% if name %}name="{{ name }}"{% endif %}
      {% if id %}id="{{ id }}"{% elseif name %}id="{{ name }}"{% endif %}
      value="{{ value }}"
      placeholder="{{ placeholder }}"
      {{ disabled ? 'disabled' }}
      {{ required ? 'required' }}
      autocomplete="{{ autocomplete }}"
      class="{{ ('flex-1 bg-transparent border-none focus:outline-none text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 ' ~ currentSize.input ~ ' ' ~ inputAttrs.render('class'))|tailwind_merge }}"
      {{ inputAttrs.without('class') }}
      data-action="input->cisse--ui-bundle--password-input#handleInput"
    >

    {# Toggle visibility button #}
    <button
      type="button"
      data-cisse--ui-bundle--password-input-target="toggle"
      data-action="click->cisse--ui-bundle--password-input#toggleVisibility"
      class="{{ ('p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shrink-0 ' ~ toggleAttrs.render('class'))|tailwind_merge }}"
      {{ toggleAttrs.without('class') }}
      {{ disabled ? 'disabled' }}
    >
      <twig:ux:icon name="heroicons:eye" data-icon="show" class="size-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300" />
      <twig:ux:icon name="heroicons:eye-slash" data-icon="hide" class="size-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hidden" />
    </button>
  </div>

  {# Strength indicator #}
  {% if showStrength %}
    <div data-cisse--ui-bundle--password-input-target="strengthContainer" class="{{ ('mt-2 hidden ' ~ strengthAttrs.render('class'))|tailwind_merge }}" {{ strengthAttrs.without('class') }}>
      <div class="h-1.5 w-full rounded-full bg-gray-200 dark:bg-slate-700 overflow-hidden">
        <div
          data-cisse--ui-bundle--password-input-target="strengthBar"
          class="h-full rounded-full transition-all duration-300 w-0"
        ></div>
      </div>
      <p data-cisse--ui-bundle--password-input-target="strengthLabel" class="mt-1 text-xs font-medium"></p>
    </div>
  {% endif %}
</div>
