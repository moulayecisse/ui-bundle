{% props
    name = null,
    id = null,
    checked = false,
    label = null,
    description = null,
    disabled = false,
    size = 'md',
    color = 'primary',
    labelPosition = 'right',
    required = false,
    value = '1',
    class = '',
%}

{# Nested attributes for fine-grained customization #}
{% set inputAttrs = attributes.nested('input') %}
{% set trackAttrs = attributes.nested('track') %}
{% set thumbAttrs = attributes.nested('thumb') %}
{% set labelAttrs = attributes.nested('label') %}
{% set descriptionAttrs = attributes.nested('description') %}

{% set switchSizes = {
    'sm': 'h-5 w-9',
    'md': 'h-6 w-11',
    'lg': 'h-7 w-14',
} %}

{% set dotSizes = {
    'sm': 'size-3',
    'md': 'size-4',
    'lg': 'size-5',
} %}

{% set translateSizes = {
    'sm': 'translate-x-5',
    'md': 'translate-x-6',
    'lg': 'translate-x-8',
} %}

{% set colorClasses = {
    'primary': { active: 'bg-primary', ring: 'peer-focus:ring-primary' },
    'success': { active: 'bg-green-500', ring: 'peer-focus:ring-green-500' },
    'warning': { active: 'bg-yellow-500', ring: 'peer-focus:ring-yellow-500' },
    'danger': { active: 'bg-red-500', ring: 'peer-focus:ring-red-500' },
    'info': { active: 'bg-blue-500', ring: 'peer-focus:ring-blue-500' },
} %}

{% set colorConfig = colorClasses[color] ?? colorClasses['primary'] %}
{% set switchId = id ?? name %}

{% set labelBlock %}{% block label label %}{% endset %}
{% set descriptionBlock %}{% block description description %}{% endset %}

{% set labelContent %}
    {% if labelBlock|trim or descriptionBlock|trim %}
        <div class="flex flex-col">
            {% if labelBlock|trim %}
                <span class="{{ ('text-sm font-medium text-gray-900 dark:text-white ' ~ labelAttrs.render('class'))|tailwind_merge }}" {{ labelAttrs.without('class') }}>
                    {{ labelBlock|raw }}
                    {% if required %}
                        <span class="text-red-500 ml-0.5">*</span>
                    {% endif %}
                </span>
            {% endif %}
            {% if descriptionBlock|trim %}
                <span class="{{ ('text-sm text-gray-500 dark:text-gray-400 ' ~ descriptionAttrs.render('class'))|tailwind_merge }}" {{ descriptionAttrs.without('class') }}>
                    {{ descriptionBlock|raw }}
                </span>
            {% endif %}
        </div>
    {% endif %}
{% endset %}

<label
    {{ attributes }}
    class="{{ ('inline-flex items-start gap-3 ' ~ (labelPosition == 'left' ? 'flex-row-reverse justify-end ' : '') ~ (disabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer') ~ ' ' ~ class)|tailwind_merge }}"
    data-color="{{ color }}"
    data-size="{{ size }}"
>
    {# Hidden checkbox for form submission #}
    <input
        type="checkbox"
        {% if name %}name="{{ name }}"{% endif %}
        {% if switchId %}id="{{ switchId }}"{% endif %}
        {% if checked %}checked{% endif %}
        {% if disabled %}disabled{% endif %}
        {% if required %}required{% endif %}
        value="{{ value }}"
        class="{{ ('sr-only peer ' ~ inputAttrs.render('class'))|tailwind_merge }}"
        {{ inputAttrs.without('class') }}
        role="switch"
        aria-checked="{{ checked ? 'true' : 'false' }}"
    >

    {# Visual switch #}
    <span
        class="{{ ((switchSizes[size] ?? switchSizes['md']) ~ ' relative inline-flex shrink-0 items-center rounded-full transition-colors focus:outline-hidden peer-focus:ring-2 ' ~ colorConfig.ring ~ ' peer-focus:ring-offset-2 dark:peer-focus:ring-offset-gray-900 peer-checked:' ~ colorConfig.active ~ ' bg-gray-300 dark:bg-gray-600 ' ~ trackAttrs.render('class'))|tailwind_merge }}"
        {{ trackAttrs.without('class') }}
    >
        <span
            class="{{ ((dotSizes[size] ?? dotSizes['md']) ~ ' inline-block transform rounded-full bg-white shadow-sm transition-transform peer-checked:' ~ (translateSizes[size] ?? translateSizes['md']) ~ ' translate-x-1 ' ~ thumbAttrs.render('class'))|tailwind_merge }}"
            {{ thumbAttrs.without('class') }}
            aria-hidden="true"
        ></span>
    </span>

    {{ labelContent|raw }}
</label>
