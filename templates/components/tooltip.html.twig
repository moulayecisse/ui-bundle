{% props
  tooltip = '',
  content = '',
  position = 'top',
  showArrow = true,
  unstyled = false,
  variant = 'dark',
  size = 'md',
  delay = 0,
  trigger = 'hover',
  class = '',
%}

{# Variant configurations #}
{% set variantConfig = {
    'dark': { bg: 'bg-black bg-opacity-90', text: 'text-white', arrow: 'bg-black bg-opacity-90' },
    'light': { bg: 'bg-white border border-gray-200 shadow-lg', text: 'text-gray-900', arrow: 'bg-white' },
    'primary': { bg: 'bg-primary', text: 'text-primary-foreground', arrow: 'bg-primary' },
} %}

{# Size configurations #}
{% set sizeConfig = {
    'sm': 'px-1.5 py-0.5 text-xs',
    'md': 'px-2 py-1 text-xs',
    'lg': 'px-3 py-1.5 text-sm',
} %}

{% set variantStyles = variantConfig[variant] ?? variantConfig['dark'] %}
{% set sizeStyles = sizeConfig[size] ?? sizeConfig['md'] %}

{% set contentBlock %}{% block content content %}{% endset %}
{% set tooltipBlock %}{% block tooltip tooltip %}{% endset %}

{% set class = ('relative ' ~ class)|tailwind_merge %}

{% set triggerActions = {
    'hover': 'mouseenter->popover#show mouseleave->popover#hide',
    'click': 'click->popover#toggle',
    'focus': 'focus->popover#show blur->popover#hide',
} %}

<div {{ attributes }} data-controller="popover" data-popover-delay-value="{{ delay }}" class="{{ class }}">
  <div
    data-action="{{ triggerActions[trigger] ?? triggerActions['hover'] }}"
    data-unstyled="{{ unstyled ? 'true' : 'false' }}"
    class="px-3 py-1 text-xs rounded-full cursor-pointer text-neutral-500 bg-slate-100 dark:bg-slate-900 data-[unstyled=true]:px-0 data-[unstyled=true]:py-0 data-[unstyled=true]:bg-transparent data-[unstyled=true]:text-inherit"
  >
    {{ contentBlock|raw }}
  </div>

  <template data-popover-target="content">
    <div
      data-popover-target="card"
      data-position="{{ position }}"
      class="absolute w-auto text-sm top-0 left-1/2 -translate-x-1/2 -mt-0.5 -translate-y-full data-[position=left]:top-1/2 data-[position=left]:-translate-y-1/2 data-[position=left]:-ml-0.5 data-[position=left]:left-0 data-[position=left]:-translate-x-full data-[position=bottom]:bottom-0 data-[position=bottom]:left-1/2 data-[position=bottom]:-translate-x-1/2 data-[position=bottom]:-mb-0.5 data-[position=bottom]:translate-y-full data-[position=right]:top-1/2 data-[position=right]:-translate-y-1/2 data-[position=right]:-mr-0.5 data-[position=right]:right-0 data-[position=right]:translate-x-full"
    >
      <div class="relative {{ sizeStyles }} {{ variantStyles.text }} {{ variantStyles.bg }} rounded">
        <div class="flex-shrink-0 block whitespace-nowrap">
          {{ tooltipBlock|raw }}
        </div>

        <div
          data-show-arrow="{{ showArrow ? 'true' : 'false' }}"
          data-position="{{ position }}"
          class="hidden data-[show-arrow=true]:block absolute inline-flex items-center justify-center overflow-hidden bottom-0 -translate-x-1/2 left-1/2 w-2.5 translate-y-full data-[position=left]:right-0 data-[position=left]:-translate-y-1/2 data-[position=left]:top-1/2 data-[position=left]:h-2.5 data-[position=left]:-mt-px data-[position=left]:translate-x-full data-[position=left]:w-auto data-[position=bottom]:top-0 data-[position=bottom]:-translate-x-1/2 data-[position=bottom]:left-1/2 data-[position=bottom]:w-2.5 data-[position=bottom]:-translate-y-full data-[position=right]:left-0 data-[position=right]:-translate-y-1/2 data-[position=right]:top-1/2 data-[position=right]:h-2.5 data-[position=right]:-mt-px data-[position=right]:-translate-x-full data-[position=right]:w-auto"
        >
          <div
            data-position="{{ position }}"
            class="w-1.5 h-1.5 transform {{ variantStyles.arrow }} origin-top-left -rotate-45 data-[position=left]:origin-top-left data-[position=left]:rotate-45 data-[position=bottom]:origin-bottom-left data-[position=bottom]:rotate-45 data-[position=right]:origin-top-right data-[position=right]:-rotate-45"
          ></div>
        </div>
      </div>
    </div>
  </template>
</div>