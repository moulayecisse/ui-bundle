{% props
  tooltip = '',
  content = '',
  position = 'top',
  showArrow = true,
  unstyled = false,
  variant = 'dark',
  size = 'md',
  trigger = 'hover',
  class = '',
%}

{# Nested attributes for fine-grained customization #}
{% set triggerAttrs = attributes.nested('trigger') %}
{% set tooltipAttrs = attributes.nested('tooltip') %}
{% set arrowAttrs = attributes.nested('arrow') %}

{# Variant configurations #}
{% set variantConfig = {
    'dark': { bg: 'bg-black/90', text: 'text-white', arrow: 'bg-black/90' },
    'light': { bg: 'bg-white border border-gray-200 shadow-lg', text: 'text-gray-900', arrow: 'bg-white' },
    'primary': { bg: 'bg-primary', text: 'text-primary-foreground', arrow: 'bg-primary' },
} %}

{# Size configurations #}
{% set sizeConfig = {
    'sm': 'px-1.5 py-0.5 text-xs',
    'md': 'px-2 py-1 text-xs',
    'lg': 'px-3 py-1.5 text-sm',
} %}

{% set variantStyles = variantConfig[variant] ?? variantConfig['dark'] %}
{% set sizeStyles = sizeConfig[size] ?? sizeConfig['md'] %}

{% set contentBlock %}{% block content content %}{% endset %}
{% set tooltipBlock %}{% block tooltip tooltip %}{% endset %}

{% set class = ('relative inline-block ' ~ class)|tailwind_merge %}

{% set triggerActions = {
    'hover': 'mouseenter->cisse--ui-bundle--popover#open mouseleave->cisse--ui-bundle--popover#close',
    'click': 'click->cisse--ui-bundle--popover#toggle',
    'focus': 'focus->cisse--ui-bundle--popover#open blur->cisse--ui-bundle--popover#close',
} %}

<div
  {{ attributes.without('trigger', 'tooltip', 'arrow') }}
  data-controller="cisse--ui-bundle--popover"
  data-cisse--ui-bundle--popover-hover-value="{{ trigger == 'hover' ? 'true' : 'false' }}"
  data-cisse--ui-bundle--popover-position-value="{{ position }}"
  class="{{ class }}"
>
  {# Trigger #}
  <div
    data-cisse--ui-bundle--popover-target="trigger"
    data-action="{{ triggerActions[trigger] ?? triggerActions['hover'] }}"
    data-unstyled="{{ unstyled ? 'true' : 'false' }}"
    class="{{ ('cursor-pointer data-[unstyled=false]:px-3 data-[unstyled=false]:py-1 data-[unstyled=false]:text-xs data-[unstyled=false]:rounded-full data-[unstyled=false]:text-neutral-500 data-[unstyled=false]:bg-slate-100 data-[unstyled=false]:dark:bg-slate-900 ' ~ triggerAttrs.render('class'))|tailwind_merge }}"
    {{ triggerAttrs.without('class') }}
  >
    {{ contentBlock|raw }}
  </div>

  {# Tooltip content #}
  <div
    data-cisse--ui-bundle--popover-target="popover"
    data-position="{{ position }}"
    role="tooltip"
    style="display: none;"
    class="{{ ('absolute z-50 ' ~ tooltipAttrs.render('class'))|tailwind_merge }}"
    {{ tooltipAttrs.without('class') }}
  >
    <div class="relative {{ sizeStyles }} {{ variantStyles.text }} {{ variantStyles.bg }} rounded whitespace-nowrap">
      {{ tooltipBlock|raw }}

      {% if showArrow %}
        <div
          data-position="{{ position }}"
          class="{{ ('absolute w-2.5 h-2.5 overflow-hidden data-[position=top]:bottom-0 data-[position=top]:left-1/2 data-[position=top]:-translate-x-1/2 data-[position=top]:translate-y-full data-[position=bottom]:top-0 data-[position=bottom]:left-1/2 data-[position=bottom]:-translate-x-1/2 data-[position=bottom]:-translate-y-full data-[position=left]:right-0 data-[position=left]:top-1/2 data-[position=left]:-translate-y-1/2 data-[position=left]:translate-x-full data-[position=right]:left-0 data-[position=right]:top-1/2 data-[position=right]:-translate-y-1/2 data-[position=right]:-translate-x-full ' ~ arrowAttrs.render('class'))|tailwind_merge }}"
          {{ arrowAttrs.without('class') }}
        >
          <div
            data-position="{{ position }}"
            class="w-1.5 h-1.5 {{ variantStyles.arrow }} transform origin-center rotate-45 data-[position=top]:translate-y-[-50%] data-[position=bottom]:translate-y-[50%] data-[position=left]:translate-x-[-50%] data-[position=right]:translate-x-[50%]"
          ></div>
        </div>
      {% endif %}
    </div>
  </div>
</div>
